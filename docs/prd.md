# 시나리오 테스트 도구 요구사항 명세서

## 1. 프로젝트 개요

### 1.1 배경
- 외부업체 연동 테스트 시 mock_server를 사용 중
- 현재 문제점:
  - Postman으로 수동으로 순서대로 요청해야 함
  - 값 세팅, 시각화 편의성 부족
  - 백엔드 개발자가 아니면 테스트 어려움

### 1.2 목표
- **노코드 시나리오 테스트 도구**
- 코드 작성 없이 UI만으로 시나리오 설계/실행/모니터링
- 현장 개발자/QA가 직접 테스트 시나리오 구성 가능
- 다양한 테스트 케이스에 재사용 가능한 범용 플랫폼

### 1.3 대상 사용자
- 현장 개발자
- QA 담당자

### 1.4 플랫폼
- React 웹 애플리케이션

---

## 2. 시스템 구성

### 2.1 기본 구조

```
                         ┌─────────────────┐
                         │   Server A      │
                         └────────┬────────┘
                              ▲   │
┌─────────────────┐           │   ▼           ┌─────────────────┐
│  React 테스트   │ ◀────────────────────────▶│   Server B      │
│      도구       │                           └─────────────────┘
└────────┬────────┘           │   ▲
         │                    ▼   │
         │               ┌─────────────────┐
         └──────────────▶│   Server N...   │
                         └─────────────────┘
```

**React 테스트 도구는 등록된 모든 서버에 요청 가능**

### 2.2 서버 설정 (확장 가능)

서버는 UI에서 동적으로 추가/삭제/수정 가능

**서버 정의 속성:**
| 속성 | 설명 | 예시 |
|------|------|------|
| name | 서버 식별 이름 | mock_server, server, payment_api |
| baseUrl | 기본 URL | http://mock.example.com |
| headers | 공통 헤더 | Authorization, Content-Type 등 |
| timeout | 요청 타임아웃 | 30000 (ms) |
| description | 설명 (선택) | "외부업체 mock 서버" |

**예시 설정:**
```
서버 목록:
  1. mock_server
     - baseUrl: http://mock.example.com
     - headers: { Content-Type: application/json }
     - timeout: 30000
     
  2. server
     - baseUrl: http://api.example.com
     - headers: { Authorization: Bearer ${token} }
     - timeout: 10000
     
  3. (필요 시 추가...)
```

**서버 간 통신 방향도 Step에서 정의:**
- Step에서 target만 지정하면 해당 서버로 요청
- 서버 간 통신 (예: mock → server)도 Step으로 표현 가능

---

## 3. 시나리오 설계 (노코드)

### 3.1 핵심 원칙

**코드 없이 UI만으로 모든 것을 설정:**
- 서버: 개수 제한 없이 추가/수정/삭제
- Step: 개수 제한 없이 추가/수정/삭제/순서변경
- 조건: 파라미터 기반 / 응답 기반 자유롭게 조합
- 분기: 조건에 따라 다른 Step으로 이동
- 반복: 배열 순회 / 횟수 지정 / 조건 충족까지
- 실행모드: Step별로 auto / manual / delayed / bypass

**시나리오 = Step들의 조합 + 분기 + 반복**
```
시나리오 = [Step1] → [Step2] → ◇분기 → [Step3a] or [Step3b] → ↺반복 → [완료]
```

---

### 3.2 Step 정의 (기본 단위)

> ⚠️ **아래 속성명과 구조는 예시입니다.** 실제 구현 시 범용적인 포맷(JSON Schema 등)으로 설계하며, 필드명/구조는 변경될 수 있습니다.

각 Step은 다음과 같은 속성들을 가질 수 있음 **(예시)**:

| 속성 | 설명 | 예시 |
|------|------|------|
| name | 단계 이름 | "시나리오 시작", "x1 요청" |
| target | 요청 대상 | mock_server, server, 또는 커스텀 URL |
| method | HTTP 메서드 | GET, POST, PUT, DELETE |
| endpoint | API 경로 | /scenario/start, /api/v1/action |
| headers | 요청 헤더 | Content-Type, Authorization 등 |
| body | 요청 본문 | 파라미터/이전응답 참조 가능 |
| executionMode | 실행 모드 | auto / manual / delayed / bypass |
| delaySeconds | 지연 시간 | 5 (delayed 모드일 때) |
| condition | 실행 조건 | 파라미터 또는 응답 기반 조건 |
| loop | 반복 설정 | 반복 조건 및 횟수 |
| waitForResponse | 응답 대기 | true: long-polling / false: 즉시 다음 |
| saveResponse | 응답 저장 | true: 이후 Step에서 참조 가능 |
| branches | 응답 분기 | 응답 값에 따라 다른 Step으로 분기 |

**응답 참조 문법 (예시):**
- `${response.stepName.field}` - 특정 Step의 응답 필드 참조
- `${response.이전Step.data.id}` - 이전 Step 응답의 data.id 참조
- body, endpoint, headers 어디서든 사용 가능

---

### 3.3 조건 (Condition) 정의

> ⚠️ **아래 구조는 예시입니다.** UI에서 시각적으로 설정하거나, JSON/YAML로 직접 작성할 수 있습니다.

**조건 소스 (2가지):**

1. **파라미터 기반 조건**
   - 시나리오 시작 시 입력한 파라미터 값으로 평가
   - UI: 드롭다운으로 필드 선택 → 연산자 선택 → 값 입력
   ```
   // 예시 구조
   {
     source: "params",
     field: "list.length",
     operator: ">=",
     value: 2
   }
   ```

2. **응답 기반 조건** (이전 Step 응답 참조)
   - 이전 Step의 응답 값으로 평가
   - UI: 참조할 Step 선택 → 응답 필드 선택 → 연산자 → 값
   ```
   // 예시 구조
   {
     source: "response",
     stepName: "시나리오 시작",
     field: "data.status",
     operator: "==",
     value: "SUCCESS"
   }
   ```

**지원 연산자:**
- 비교: `==`, `!=`, `>`, `>=`, `<`, `<=`
- 포함: `contains`, `notContains`
- 존재: `isEmpty`, `isNotEmpty`, `exists`
- 논리 조합: `AND`, `OR` (여러 조건 묶기)

**조건 없음 = 무조건 실행**

**응답 기반 조건분기 예시:**
```
Step: "결과 처리"
condition:
  - source: response
    stepName: "API 호출"
    field: "data.code"
    operator: "=="
    value: 200
    then: "성공 처리 Step으로"
  - source: response
    stepName: "API 호출"
    field: "data.code"
    operator: "=="
    value: 500
    then: "에러 처리 Step으로"
```

---

### 3.4 반복 (Loop) 정의

> ⚠️ **아래 구조는 예시입니다.** UI에서 시각적으로 설정하거나, JSON/YAML로 직접 작성할 수 있습니다.

**반복 구조 (예시):**
```
{
  type: "forEach",             // forEach / count / while
  source: "list",              // 반복 대상 배열
  countField: "count",         // 각 항목에서 반복 횟수 필드
  steps: ["x2", "x3"]          // 반복할 Step 이름들
}
```

**반복 타입:**
- `forEach`: 배열의 각 항목마다 실행
- `count`: 고정 횟수 반복
- `while`: 조건 만족하는 동안 반복

---

### 3.5 분기 (Branch) 정의

> ⚠️ **아래 구조는 예시입니다.** UI에서 시각적으로 설정하거나, JSON/YAML로 직접 작성할 수 있습니다.

**응답 값에 따라 다른 Step으로 분기 (예시):**

```
{
  branches: [
    {
      condition: {
        source: "response",
        field: "status",
        operator: "==",
        value: "SUCCESS"
      },
      nextStep: "성공 처리"
    },
    {
      condition: {
        source: "response",
        field: "status",
        operator: "==",
        value: "PENDING"
      },
      nextStep: "재시도"
    },
    {
      default: true,
      nextStep: "에러 처리"
    }
  ]
}
```

**분기 타입:**
- **조건 분기**: 응답/파라미터 값에 따라 다른 경로
- **기본 분기 (default)**: 어떤 조건도 맞지 않을 때
- **다중 분기**: 여러 조건 → 여러 경로 (switch-case 형태)

**시각화:**
- 다이어그램에서 분기점은 마름모(◇)로 표시
- 각 분기 경로에 조건 라벨 표시

---

### 3.6 시나리오 정의 방식

**2가지 방식 지원 (상호 변환 가능):**

| 방식 | 설명 | 대상 |
|------|------|------|
| **UI 설정** | 드래그앤드롭, 폼 입력으로 구성 | 비개발자, QA, 현장 개발자 |
| **코드 작성** | JSON/YAML 직접 작성 | 개발자, 자동화 스크립트 |

**UI ↔ 코드 실시간 동기화:**
- UI에서 설정 변경 → JSON/YAML 자동 반영
- JSON/YAML 직접 수정 → UI에 자동 반영

**코드 작성 시 범용 포맷 사용:**
- JSON Schema 또는 YAML 기반
- 버전 관리 (Git) 용이
- 다른 시스템과 연동 가능 (CI/CD, 자동화 등)

---

### 3.7 노코드로 시나리오 구성하기

**UI에서 설정만으로 시나리오 생성:**
1. 시나리오 이름 입력
2. 서버 엔드포인트 등록 (개수 제한 없음)
3. 파라미터 스키마 정의
4. Step 추가/편집/삭제/순서변경
5. 각 Step의 조건, 분기, 반복, 실행모드 설정
6. 저장 → 바로 테스트 가능

**코드 수정 없이 대응 가능한 것들:**
- 서버 추가/변경
- API 엔드포인트 변경
- 조건 로직 변경
- 반복 패턴 변경
- 분기 경로 추가/수정
- Step 순서 변경
- 새로운 시나리오 생성

---

## 4. UI 요구사항

### 4.1 화면 구성 개요

**2가지 모드:**
1. **설정 모드**: 시나리오 정의 (Step 추가/편집, 조건 설정 등)
2. **실행 모드**: 시나리오 실행 및 모니터링

---

### 4.2 설정 모드 화면

```
┌────────────────────────────────────────────────────────────────────┐
│  시나리오 설정                              [저장] [불러오기] [새로] │
├────────────────────────────────────────────────────────────────────┤
│                                                                    │
│  시나리오명: [외부업체 연동 테스트        ]                         │
│                                                                    │
│  ┌─────────────────────┐  ┌─────────────────────────────────────┐ │
│  │   서버 설정          │  │        서버 상세 편집                │ │
│  │                     │  │                                     │ │
│  │  [+ 서버 추가]      │  │  이름: [mock_server        ]        │ │
│  │                     │  │  URL:  [http://mock.exam..]        │ │
│  │  ● mock_server      │  │  Timeout: [30000] ms                │ │
│  │  ○ server           │  │                                     │ │
│  │  ○ payment_api      │  │  공통 헤더:                         │ │
│  │                     │  │  [+ 헤더 추가]                      │ │
│  │  [서버 삭제]        │  │  ┌─ Content-Type ─────────────────┐ │ │
│  │                     │  │  │ application/json              │ │ │
│  └─────────────────────┘  │  └────────────────────────────────┘ │ │
│                           │  ┌─ Authorization ────────────────┐ │ │
│                           │  │ Bearer ${token}               │ │ │
│                           │  └────────────────────────────────┘ │ │
│                           └─────────────────────────────────────┘ │
│                                                                    │
│  ┌─────────────────────┐  ┌─────────────────────────────────────┐ │
│  │  파라미터 스키마     │  │        Step 편집                    │ │
│  │                     │  │                                     │ │
│  │  [+ 필드 추가]      │  │  Step명: [x1 요청           ]       │ │
│  │  ┌───────────────┐  │  │  Target: [mock_server    ▼]        │ │
│  │  │ list: Array   │  │  │  Method: [POST ▼]                  │ │
│  │  │  └ id: number │  │  │  Endpoint: [/scenario/x1   ]       │ │
│  │  │  └ count: num │  │  │                                     │ │
│  │  └───────────────┘  │  │  실행모드: ○자동 ○수동 ○지연 ○바이패스│ │
│  │                     │  │                                     │ │
│  └─────────────────────┘  │  ☑ 응답 저장 (이후 Step에서 참조)    │ │
│                           │                                     │ │
│  ┌─────────────────────┐  │  조건: [+ 조건 추가        ]        │ │
│  │  Step 목록          │  │   └ params.list.length >= 2        │ │
│  │  (드래그 순서변경)   │  │                                     │ │
│  │                     │  │  분기: [+ 분기 추가        ]        │ │
│  │  1. 시나리오 시작   │  │   └ response.status == SUCCESS     │ │
│  │  2. x1 요청    ◇   │  │     → 다음: [완료 처리 ▼]          │ │
│  │  3. x2,x3 반복 ↺   │  │   └ default                        │ │
│  │  4. 완료 처리       │  │     → 다음: [에러 처리 ▼]          │ │
│  │  5. 에러 처리       │  │                                     │ │
│  │  [+ Step 추가]      │  │  반복: [설정...             ]       │ │
│  └─────────────────────┘  └─────────────────────────────────────┘ │
│  └─────────────────────┘                                          │
└────────────────────────────────────────────────────────────────────┘
```

**설정 모드 기능:**
| 영역 | 기능 |
|------|------|
| 서버 설정 | 서버 추가/삭제, 선택하여 상세 편집 |
| 서버 상세 편집 | 이름, URL, 타임아웃, 공통 헤더 설정 |
| 파라미터 스키마 | 필드 추가/삭제, 타입 지정, 중첩 구조 |
| Step 목록 | Step 추가/삭제, 드래그로 순서 변경, 아이콘으로 분기(◇)/반복(↺) 표시 |
| Step 편집 | target, method, endpoint, 실행모드, 응답저장, 조건, 분기, 반복 설정 |
| 조건 설정 | 파라미터 기반 / 응답 기반 조건 추가 (UI 빌더) |
| 분기 설정 | 조건별 다음 Step 지정, default 분기 설정 |
| 저장/불러오기 | 시나리오 설정 JSON/YAML 내보내기/가져오기 |

---

### 4.3 실행 모드 화면

```
┌────────────────────────────────────────────────────────────────────┐
│  시나리오 실행: 외부업체 연동 테스트                    [설정으로] │
├────────────────────────────────────────────────────────────────────┤
│                                                                    │
│  ┌─────────────────────┐  ┌─────────────────────────────────────┐ │
│  │   파라미터 입력      │  │        시퀀스 다이어그램             │ │
│  │                     │  │                                     │ │
│  │  [UI 폼] [JSON]    │  │   ●━━━━○━━━━○━━━━○━━━━○            │ │
│  │  ─────────────────  │  │   시작  x1   x2   x3   완료          │ │
│  │                     │  │         ↑                           │ │
│  │  List 항목:         │  │      현재 단계                      │ │
│  │  [+ 항목 추가]      │  │                                     │ │
│  │  ┌───────────────┐  │  └─────────────────────────────────────┘ │
│  │  │ id: [1    ]   │  │                                          │
│  │  │ count: [3 ]   │  │  ┌─────────────────────────────────────┐ │
│  │  └───────────────┘  │  │     시퀀스 미리보기 (자동 생성)       │ │
│  │                     │  │                                     │ │
│  │  Step별 실행모드:   │  │  시작→x1→(x2,x3)×3→완료             │ │
│  │  x1: [자동    ▼]   │  │  예상 요청: 8회                      │ │
│  │  x2,x3: [ON/OFF]   │  │                                     │ │
│  │                     │  └─────────────────────────────────────┘ │
│  │                     │                                          │
│  │  [▶ 시나리오 시작]  │  ┌─────────────────────────────────────┐ │
│  │                     │  │        요청/응답 로그                │ │
│  │  [수동실행] (대기시)│  │                                     │ │
│  │                     │  │  10:30:01 → POST /start   ✓ 200    │ │
│  └─────────────────────┘  │  10:30:02 → POST /x1      ✓ 200    │ │
│                           │  10:30:03 → POST /x2      ⏳ 대기   │ │
│                           └─────────────────────────────────────┘ │
└────────────────────────────────────────────────────────────────────┘
```

**실행 모드 기능:**
| 영역 | 기능 |
|------|------|
| 파라미터 입력 | UI 폼 / JSON 직접 입력 (탭 전환) |
| Step별 실행모드 | 각 Step의 실행모드 런타임 선택 |
| 시퀀스 미리보기 | 파라미터 기반 예상 흐름 자동 생성, 분기 경로 포함 |
| 시퀀스 다이어그램 | 현재 진행 단계 실시간 표시, 분기(◇)/반복(↺) 시각화 |
| 요청/응답 로그 | 실시간 로그, 클릭 시 상세 보기, 응답 값 확인 |
| 수동실행 버튼 | 수동 모드 Step 대기 시 표시 |

**다이어그램 표기법:**
| 기호 | 의미 |
|------|------|
| ● | 시작점 |
| ○ | 일반 Step |
| ◇ | 분기점 (조건에 따라 다른 경로) |
| ↺ | 반복 구간 |
| ◉ | 종료점 |

---

## 5. 시나리오 예시

> ⚠️ **이 섹션의 모든 시나리오는 예시입니다.**
> - 노코드 도구의 범용성을 보여주기 위한 것
> - 실제 필드명, 구조, 조건식은 UI에서 자유롭게 정의 가능
> - JSON/YAML 구조도 구현 시 범용적인 포맷으로 설계

### 5.1 예시: 외부업체 연동 테스트 (조건분기 + 반복)

**배경:** 기존에 "조건분기1", "조건분기2"로 불리던 테스트를 노코드로 구성한 예시

```
시나리오명: "외부업체 연동 테스트"

서버:
  - mock_server: http://mock.example.com
  - server: http://api.example.com

파라미터:
  - list: Array<{ id: number, count: number }>

Steps:
  1. 시나리오 시작
     - target: mock_server
     - endpoint: /scenario/start
     - body: { list: ${params.list} }
     - waitForResponse: true (long-polling)
     
  2. x1 요청 (구 조건분기1)
     - target: mock_server
     - endpoint: /scenario/x1
     - 조건: params.list.length >= 2 OR params.list[0].count >= 2
     - 실행모드: auto / manual / delayed / bypass (선택)
     
  3. x2, x3 반복 (구 조건분기2)
     - toggle: ON/OFF
     - 반복: forEach(params.list) × item.count
     - Steps:
         - x2 → mock_server /scenario/x2
         - x3 → mock_server /scenario/x3
         
  4. 완료
     - target: mock_server → server
     - endpoint: /scenario/complete
```

**실행 흐름 예시:**
```
입력: list = [{ id: 1, count: 2 }, { id: 2, count: 3 }]

시작 → x1 → (x2,x3)×2 → (x2,x3)×3 → 완료
            └ 1번 항목 ┘  └ 2번 항목 ┘
```

---

### 5.2 예시: 응답 기반 분기 (결제 플로우)

```
시나리오명: "결제 플로우"

Steps:
  1. 결제 요청 → payment_gateway
     saveResponse: true
     
  2. 결과 확인 (분기)
     branches:
       - condition: response.결제요청.status == "SUCCESS"
         nextStep: "완료 처리"
       - condition: response.결제요청.status == "PENDING"
         nextStep: "폴링 대기"
       - default: true
         nextStep: "에러 처리"
         
  3. 폴링 대기
     loop: while (response.상태확인.status == "PENDING")
     
  4. 완료 처리 → our_server
  
  5. 에러 처리 → our_server (알림 발송)
```

**다이어그램 시각화:**
```
[결제 요청] → ◇ 결과 확인
              ├─ SUCCESS → [완료 처리]
              ├─ PENDING → [폴링 대기] ─↺
              └─ ERROR   → [에러 처리]
```

### 5.3 예시: 복잡한 다중 분기 (주문 처리)

```
시나리오명: "주문 처리 플로우"

Steps:
  1. 주문 생성 → order_server
     saveResponse: true
     
  2. 재고 확인 → inventory_server
     body: { productId: ${response.주문생성.data.productId} }
     saveResponse: true
     
  3. 재고 분기
     branches:
       - condition: response.재고확인.data.stock > 0
         nextStep: "결제 진행"
       - default: true
         nextStep: "품절 처리"
         
  4. 결제 진행 → payment_server
     saveResponse: true
     
  5. 결제 분기
     branches:
       - condition: response.결제진행.status == "SUCCESS"
         nextStep: "배송 요청"
       - default: true
         nextStep: "결제 실패 처리"
         
  6. 배송 요청 → delivery_server
  7. 품절 처리 → notification_server
  8. 결제 실패 처리 → notification_server
```

**핵심: UI 설정 또는 범용 JSON/YAML로 복잡한 분기 로직도 코드 수정 없이 구현 가능**

---

## 6. 주의사항

### 6.1 실행 관련
1. **Long-polling 처리**: waitForResponse=true인 Step은 UI 블로킹 없이 비동기 처리
2. **수동 모드**: 수동 실행 대기 시 명확한 버튼 표시
3. **에러 처리**: Step 실패 시 재시도/건너뛰기/중단 옵션 제공

### 6.2 확장성 관련
1. **시나리오 저장**: 설정을 JSON/YAML로 내보내기/가져오기 가능해야 함
2. **서버 관리**: 
   - 서버는 개수 제한 없이 추가 가능
   - 한번 등록한 서버는 여러 시나리오에서 재사용
   - 서버별 공통 헤더, 타임아웃 등 개별 설정
   - 헤더에 변수 참조 가능 (예: `${token}`)
3. **Step 템플릿**: 자주 쓰는 Step 패턴을 템플릿으로 저장
4. **변수 참조**: body, endpoint, headers 등에서 파라미터 값 참조 가능 (예: `${params.list}`)

### 6.3 UI/UX 관련
1. **실시간 동기화**: UI 폼 ↔ JSON 에디터 양방향 동기화
2. **유효성 검사**: 설정 저장 전 필수값, 타입 검사
3. **시퀀스 미리보기**: 파라미터 변경 시 즉시 업데이트
